Firstly we compute the total number of opening and closing brackets; clearly if they don't match then we cannot rearrange them.  If they do match then we do the usual counting of unmatched opening brackets by adding one for "$$($$" and subtracting one for "$$)$$".  While doing that we compute the total length of segments from the point where our counter became negative to the first point when it came back to zero (note that it *will* be zero at the very end).  We need to reshuffle all those segments and so their cumulative length is our answer.
