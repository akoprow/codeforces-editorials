{% include exercise.md name="Close Tuples (hard version)" id="1462E2" labels="binary search, combinatorics, implementation, math, sortings, two pointers" rating=1700 code="r680-699/r690/1462e2-close-tuples-hard.kt" %}

Note that the order does not matter so let's assume that the array is sorted in an ascending order for ease of reasoning (and let's actually sort it so).  Now we'll consider numbers from left to right as the potential minimal elements in a triple, so that all the remaining elements of the triple must be to their right.  Once we consider a number $$v$$ at a given position we use binary search to find index of the element $$v+k$$ to the right of it.  So now  know how many elements, other than $$v$$ itself, fall into the $$[v, v+k]$$ segment which can be used to form a triple "rooted" at $$v$$, if there are $$n$$ such elements then they add $$n\choose{m-1}$$ to the answer ($$v$$ is the $$m$$'th element).  What remains to be done is to be sure to precompute factorials so that we can compute those binomial coefficients efficiently.
