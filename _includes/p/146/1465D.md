{% include exercise.md name="Grime Zoo" id="1465D" also-as="1464B" labels="dp, greedy, implementation, math" rating=2100 code="r680-699/r692/1465d-grime-zoo.kt" %}

Assume $$x > y$$; the other case is symmetrical (or we can just swap $$x$$ and $$y$$ and flip the string $$0 \to 1, 1 \to 0$$).

Let's consider what happens to a configuration $$\vec{u}\ 1 \ \vec{v}\ 0 \ \vec{z}$$ if we change it to $$\vec{u}\ 0\ \vec{v}\ 1\ \vec{z}$$. Firstly, observe that the block between $$\vec{u}$$ and $$\vec{z}$$ has the same number of $$0$$s and $$1$$s in both cases and so the cost of pairs with at least one element outside of that block will be the same.  So we can just compare $$1\ \vec{v}\ 0$$ with $$0\ \vec{v}\ 1$$.  Block in the middle is again the same so we can just focus on how much pairs involving first and/or last elements contribute to the answer; let's denote it by function $$f$$.  Assume that within $$\vec{v}$$ we have $$v_0$$ zeroes and $$v_1$$ ones.  Then we have:

$$f(1\ \vec{v}\ 0) - f(0\ \vec{v}\ 1) = ((1+v_1)y + v_0 y) - ((1+v_1) x + v_0 x) = (1 + v_0 + v_1)(y - x)$$

$$1 + v_0 + v_1$$ is positive as all its elements are positive.  Since $$x > y$$ that means that $$y-x$$ is negative and hence so is the whole formula.  Which means that by flipping $$1\ \vec{v}\ 0$$ to $$0\ \vec{v}\ 1$$ we can *always* decrease the overall cost.  Which further means that, by continuing to apply this logic, in the final answer (i.e. what we substitute question marks for) we cannot have a $$1$$ followed by a $$0$$.  That means it must be of the shape $$00 \ldots 11$$.

Now, the idea is to try to iterate over the number of $$0$$s in that final answer and pick the option that gives the lowest cost.  How can we do that efficiently?

Let's begin by computing the cost of $$11 \ldots 11$$ and then we will be successively "inserting" $$0$$s from the left. To do that we iterate through the string and keep track of: number of zeroes, $$z$$, and number of $$10$$ pairs we've seen, $$oz$$.  Number of ones, $$o$$ and of $$01$$ pairs, $$zo$$, can be easily derived from that, as we have: $$z + o = i$$ (where $$i$$ is the number of characters we've considered so far) and $$zo + oz = o*z$$, i.e. we need to pick some zero and some one to form a pair of distinct digits ($$01$$ or $$10$$).

Now we will sweep from left to right to replace ones with zeroes. To do that we will keep of four variables: $$z_l, z_r, o_l, o_r$$, which are, respectively, number of zeroes/ones to the left/right of the index we're considering.  When we see $$0$$ or $$1$$ we just update those variables, which is fairly simple.  When we see $$"?"$$ we will be replacing $$1$$ with a $$0$$ and on top of updating those variables (careful!) we also need to update the score, we're adding $$o_l$$ $$10$$ pairs to the left and $$o_r$$ $$01$$ pairs to the right and removing $$z_l$$ $$01$$ pairs to the left and $$z_r$$ $$10$$ pairs to the right, so in total we're incrementing the score by $$y(o_l - z_r) + x(o_r - z_l)$$.  We then take the minimal score across all considered options.
