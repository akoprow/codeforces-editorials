To maximize marker changes we want to use values with $$a_i$$ as small as possible and between them place large values, since they don't matter.  So sort everything and use double ended queue to construct optimal solution.
