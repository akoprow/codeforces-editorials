Firstly, clearly we only need to keep track of the top card of each color.  Secondly, when we move card from position $$p$$ to the top then the index of all the cards which previously had an index less than $$p$$ increases by $$1$$.  So this easily leads to a simulation of the process with $$O(nk)$$ complexity.
