It was fairly easy to solve it (greedily) but much harder to prove that that (greedy) solution works.  The main observation is that we have $$k^2$$ pairs of letters and we want to use them "uniformly", i.e. if the generated string is short enough then just use as many of those pairs as we can, as that will give us a $$0$$ cost.  Otherwise, try to repeat each pair as few times as possible.  We essentially do it by keeping track of unused pairs and being careful not to get into a letter from which we cannot move forward (i.e. do not follow $$x$$ with $$y$$ if there are no moves from $$y$$).  Once we use all the pairs recreate them again and start from scratch.

There's a nice interpretation of this problem where we are basically looking for an Eulerian cycle in a graph (a clique actually) of letters.
