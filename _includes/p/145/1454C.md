Let's process by blocks (of equal values) and keep track of the number of blocks for each number.  Now, if we pick $$x$$ the answer is the number of blocks of $$x$$ plus $$1$$, as there are that many segments between: $$\ldots, x, \ldots, x, \ldots$$, except decrement that by $$1$$ if $$x$$ is the first element and further by $$1$$ if its last.
